<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Control - PDV Completo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- ✅ SDK DO FIREBASE ADICIONADO -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        /* SEU CSS ORIGINAL (mantido intacto) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        /* ... (TODO O SEU CSS ORIGINAL) ... */

        /* ✅ NOVO ESTILO PARA STATUS DO FIREBASE */
        .firebase-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #2ed573;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1001;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #2575fc;
        }
    </style>
</head>
<body>
    <!-- ✅ INDICADOR DE CONEXÃO FIREBASE -->
    <div class="firebase-status" id="firebase-status" style="display: none;">
        <i class="fas fa-database"></i> Conectado ao Firebase
    </div>
    
    <div class="container">
        <!-- SEU HTML ORIGINAL (mantido intacto) -->
        <div class="header">
            <div class="user-actions">
                <i class="fas fa-bell"></i>
                <i class="fas fa-cog"></i>
            </div>
            <h2>Business Control</h2>
            <div class="date-display" id="current-date">Segunda-feira, 25 de Setembro de 2023</div>
        </div>
        
        <div class="content">
            <!-- Dashboard Tab -->
            <div class="tab-content" id="dashboard">
                <div class="card">
                    <div class="card-title">
                        <span>Visão Geral</span>
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <p>Resumo do desempenho do seu negócio</p>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="today-sales">R$ 0,00</div>
                            <div class="stat-label">Vendas Hoje</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="month-sales">R$ 0,00</div>
                            <div class="stat-label">Vendas Mês</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="goal-percentage">0%</div>
                            <div class="stat-label">Meta</div>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="goal-progress" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Produtos Mais Vendidos</span>
                        <i class="fas fa-star"></i>
                    </div>
                    
                    <div class="report-section" id="top-products-section">
                        <div class="loading">Carregando produtos...</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Melhores Clientes</span>
                        <i class="fas fa-users"></i>
                    </div>
                    
                    <div class="report-section" id="top-clients-section">
                        <div class="loading">Carregando clientes...</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Próximos Recebimentos</span>
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div id="dashboard-receivables">
                        <div class="loading">Carregando recebíveis...</div>
                    </div>
                </div>
            </div>
            
            <!-- ... (TODO O SEU HTML ORIGINAL) ... -->
        </div>
        
        <div class="nav">
            <div class="nav-item" data-tab="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item active" data-tab="pdv">
                <i class="fas fa-cash-register"></i>
                <span>PDV</span>
            </div>
            <div class="nav-item" data-tab="stock">
                <i class="fas fa-boxes"></i>
                <span>Estoque</span>
            </div>
            <div class="nav-item" data-tab="clients">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </div>
            <div class="nav-item" data-tab="receivables">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>A Receber</span>
            </div>
            <div class="nav-item" data-tab="reports">
                <i class="fas fa-chart-bar"></i>
                <span>Relatórios</span>
            </div>
        </div>
    </div>

    <!-- Modal de Finalização de Venda -->
    <div class="modal" id="sale-modal">
        <!-- ... (modal original) ... -->
    </div>

    <script>
        // ✅ CONFIGURAÇÃO DO FIREBASE - SUBSTITUA COM SUAS CONFIGURAÇÕES REAIS
        const firebaseConfig = {
            apiKey: "AIzaSyCLaJ6v5lw1Hq3Q2X7Q3a9bKj8LmNpOqRSt",
            authDomain: "controle-de-vendas-bf26d.firebaseapp.com",
            databaseURL: "https://controle-de-vendas-bf26d-default-rtdb.firebaseio.com",
            projectId: "controle-de-vendas-bf26d",
            storageBucket: "controle-de-vendas-bf26d.firebasestorage.app",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456789abcdef"
        };

        // ✅ INICIALIZAÇÃO DO FIREBASE
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            document.getElementById('firebase-status').style.display = 'block';
            console.log('✅ Firebase conectado com sucesso!');
        } catch (error) {
            console.error('❌ Erro ao conectar com Firebase:', error);
        }

        // Dados da aplicação (agora serão sincronizados com Firebase)
        let cart = [];
        let total = 0;
        let clients = [];
        let products = [];
        let salesHistory = [];
        let receivables = [];
        
        let sales = {
            today: 0,
            month: 0,
            goal: 30000
        };

        // ✅ FUNÇÕES FIREBASE
        async function saveToFirebase(path, data) {
            try {
                await database.ref(path).set(data);
                console.log('✅ Dados salvos no Firebase:', path);
                return true;
            } catch (error) {
                console.error('❌ Erro ao salvar no Firebase:', error);
                return false;
            }
        }

        async function loadFromFirebase(path) {
            try {
                const snapshot = await database.ref(path).once('value');
                console.log('✅ Dados carregados do Firebase:', path);
                return snapshot.val();
            } catch (error) {
                console.error('❌ Erro ao carregar do Firebase:', error);
                return null;
            }
        }

        function arrayToObject(array) {
            const obj = {};
            array.forEach(item => {
                if (item && item.id) {
                    obj[item.id] = item;
                }
            });
            return obj;
        }

        // ✅ FUNÇÕES DE CARREGAMENTO ATUALIZADAS
        async function loadClients() {
            const firebaseClients = await loadFromFirebase('clients');
            clients = firebaseClients ? Object.values(firebaseClients) : [];
            
            // Dados iniciais se não houver clientes
            if (clients.length === 0) {
                clients = [
                    { id: 1, name: "João Silva", email: "joao@email.com", phone: "(11) 99999-9999", totalPurchases: 0 },
                    { id: 2, name: "Maria Santos", email: "maria@email.com", phone: "(11) 98888-8888", totalPurchases: 0 },
                    { id: 3, name: "Empresa ABC", email: "contato@empresa.com", phone: "(11) 97777-7777", totalPurchases: 0 }
                ];
                await saveToFirebase('clients', arrayToObject(clients));
            }
            
            updateClientsUI();
        }

        async function loadProducts() {
            const firebaseProducts = await loadFromFirebase('products');
            products = firebaseProducts ? Object.values(firebaseProducts) : [];
            updateProductsUI();
        }

        async function loadSalesHistory() {
            const firebaseSales = await loadFromFirebase('sales');
            salesHistory = firebaseSales ? Object.values(firebaseSales) : [];
            calculateSalesTotals();
            updateDashboard();
        }

        async function loadReceivables() {
            const firebaseReceivables = await loadFromFirebase('receivables');
            receivables = firebaseReceivables ? Object.values(firebaseReceivables) : [];
            updateReceivablesUI();
        }

        // ✅ FUNÇÕES DE SALVAMENTO ATUALIZADAS
        async function saveClient(client) {
            if (client.id) {
                const index = clients.findIndex(c => c.id === client.id);
                if (index !== -1) {
                    clients[index] = client;
                }
            } else {
                const newId = clients.length > 0 ? Math.max(...clients.map(c => c.id)) + 1 : 1;
                client.id = newId;
                clients.push(client);
            }
            
            await saveToFirebase('clients', arrayToObject(clients));
            updateClientsUI();
        }

        async function saveProduct(product) {
            if (product.id) {
                const index = products.findIndex(p => p.id === product.id);
                if (index !== -1) {
                    products[index] = product;
                }
            } else {
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                product.id = newId;
                products.push(product);
            }
            
            await saveToFirebase('products', arrayToObject(products));
            updateProductsUI();
        }

        async function saveSale(sale) {
            salesHistory.push(sale);
            await saveToFirebase('sales', arrayToObject(salesHistory));
        }

        async function saveReceivable(receivable) {
            receivables.push(receivable);
            await saveToFirebase('receivables', arrayToObject(receivables));
        }

        // ✅ FUNÇÃO DE VENDA ATUALIZADA COM FIREBASE
        async function finalizeSale(paymentMethod, clientId, dueDate = null) {
            const clientName = clientId ? clients.find(c => c.id === parseInt(clientId)).name : 'Cliente não identificado';
            
            // Criar objeto de venda
            const saleId = salesHistory.length > 0 ? Math.max(...salesHistory.map(s => s.id)) + 1 : 1;
            const saleDate = new Date().toISOString();
            
            const sale = {
                id: saleId,
                date: saleDate,
                clientId: clientId ? parseInt(clientId) : null,
                clientName: clientName,
                items: [...cart],
                total: total,
                paymentMethod: paymentMethod
            };
            
            // Salvar venda no Firebase
            await saveSale(sale);
            
            // Se for a prazo, criar recebível
            if (paymentMethod === 'term' && dueDate) {
                const receivableId = receivables.length > 0 ? Math.max(...receivables.map(r => r.id)) + 1 : 1;
                const receivable = {
                    id: receivableId,
                    client: clientName,
                    value: total,
                    dueDate: dueDate,
                    status: 'pending',
                    saleId: saleId
                };
                await saveReceivable(receivable);
            }
            
            // Atualizar cliente
            if (clientId) {
                const client = clients.find(c => c.id === parseInt(clientId));
                if (client) {
                    client.totalPurchases += total;
                    await saveClient(client);
                }
            }
            
            // Atualizar estoque
            await updateStockAfterSale();
            
            // Atualizar dashboard
            sales.today += total;
            sales.month += total;
            
            // Limpar carrinho
            cart = [];
            updateCart();
            
            // Recarregar dados
            await loadProducts();
            await loadReceivables();
            updateDashboard();
            
            return true;
        }

        async function updateStockAfterSale() {
            const updates = [];
            cart.forEach(cartItem => {
                const product = products.find(p => p.id === cartItem.id);
                if (product) {
                    product.stock -= cartItem.quantity;
                    if (product.stock < 0) product.stock = 0;
                    updates.push(saveProduct(product));
                }
            });
            await Promise.all(updates);
        }

        // ✅ SUAS FUNÇÕES ORIGINAIS (com pequenas adaptações)
        function updateClientsUI() {
            clientSelect.innerHTML = '<option value="">Selecionar cliente...</option>';
            clientList.innerHTML = '';
            
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                clientSelect.appendChild(option);
                
                const li = document.createElement('li');
                li.className = 'client-item';
                li.innerHTML = `
                    <div class="client-info">
                        <strong>${client.name}</strong>
                        <div>${client.email} | ${client.phone}</div>
                        <div>Total em compras: R$ ${client.totalPurchases.toFixed(2)}</div>
                    </div>
                    <div class="client-actions">
                        <i class="fas fa-edit edit-client" data-id="${client.id}"></i>
                        <i class="fas fa-trash delete-client" data-id="${client.id}"></i>
                    </div>
                `;
                clientList.appendChild(li);
            });
            
            // Adicionar event listeners
            document.querySelectorAll('.edit-client').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const clientId = this.getAttribute('data-id');
                    editClient(clientId);
                });
            });
            
            document.querySelectorAll('.delete-client').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const clientId = this.getAttribute('data-id');
                    deleteClient(clientId);
                });
            });
        }

        // ... (MANTENHA TODAS AS SUAS OUTRAS FUNÇÕES ORIGINAIS)

        // ✅ INICIALIZAÇÃO ATUALIZADA
        document.addEventListener('DOMContentLoaded', async function() {
            // Carregar dados do Firebase
            await loadClients();
            await loadProducts();
            await loadSalesHistory();
            await loadReceivables();
            
            updateDashboard();
            setupEventListeners();
            updateDateTime();
            
            const today = new Date().toISOString().split('T')[0];
            dueDateInput.setAttribute('min', today);
            
            reportPeriod.addEventListener('change', generateReport);
            reportType.addEventListener('change', generateReport);
        });

        // ✅ CONFIGURE OS EVENT LISTENERS PARA USAR AS FUNÇÕES ASYNC
        function setupEventListeners() {
            // Seus event listeners originais aqui...
            
            // Modifique os que salvam dados para usar async/await
            saveClientBtn.addEventListener('click', async function() {
                const id = clientIdInput.value;
                const name = clientNameInput.value;
                const email = clientEmailInput.value;
                const phone = clientPhoneInput.value;
                
                if (!name) {
                    alert('Por favor, preencha o nome do cliente.');
                    return;
                }
                
                const client = { 
                    id: id ? parseInt(id) : null, 
                    name, 
                    email, 
                    phone, 
                    totalPurchases: id ? clients.find(c => c.id === parseInt(id))?.totalPurchases || 0 : 0 
                };
                
                await saveClient(client);
                clientFormCard.style.display = 'none';
            });

            saveProductBtn.addEventListener('click', async function() {
                const id = productIdInput.value;
                const name = productNameInput.value;
                const code = productCodeInput.value;
                const cost = parseFloat(productCostInput.value) || 0;
                const price = parseFloat(productPriceInput.value) || 0;
                const stock = parseInt(productStockInput.value) || 0;
                
                if (!name || !code) {
                    alert('Por favor, preencha pelo menos o nome e código do produto.');
                    return;
                }
                
                const product = { id: id ? parseInt(id) : null, name, code, cost, price, stock };
                await saveProduct(product);
                productFormCard.style.display = 'none';
            });

            // Modifique a função de confirmar venda
            confirmSaleBtn.addEventListener('click', async function() {
                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                const clientId = clientSelect.value;
                const dueDate = paymentMethod === 'term' ? dueDateInput.value : null;
                
                if (paymentMethod === 'term' && !dueDate) {
                    alert('Por favor, selecione uma data de vencimento para vendas a prazo.');
                    return;
                }
                
                const success = await finalizeSale(paymentMethod, clientId, dueDate);
                if (success) {
                    saleModal.style.display = 'none';
                    clientSelect.value = '';
                    alert('Venda finalizada com sucesso!');
                }
            });
        }

        // ... (COLE AQUI TODAS AS SUAS OUTRAS FUNÇÕES ORIGINAIS)

    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Control - PDV Completo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .user-actions {
            position: absolute;
            right: 15px;
            top: 15px;
        }
        
        .user-actions i {
            margin-left: 10px;
            font-size: 18px;
        }
        
        .date-display {
            font-size: 14px;
            margin-top: 5px;
            opacity: 0.9;
        }
        
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #f0f0f0;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2575fc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #2575fc;
        }
        
        .stat-label {
            font-size: 12px;
            color: #888;
        }
        
        .product-list, .client-list {
            list-style: none;
            margin-top: 10px;
        }
        
        .product-item, .client-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }
        
        .product-item:last-child, .client-item:last-child {
            border-bottom: none;
        }
        
        .product-info, .client-info {
            flex: 2;
        }
        
        .product-stock, .client-value {
            flex: 1;
            text-align: right;
            font-weight: 600;
            color: #2575fc;
        }
        
        .low-stock {
            color: #ff4757;
        }
        
        .nav {
            display: flex;
            background: white;
            border-top: 1px solid #f0f0f0;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            color: #888;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            color: #2575fc;
        }
        
        .nav-item i {
            display: block;
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress {
            height: 100%;
            background: #2575fc;
            border-radius: 3px;
        }
        
        .sale-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .sale-info {
            flex: 2;
        }
        
        .sale-value {
            flex: 1;
            text-align: right;
            font-weight: 600;
        }
        
        .paid {
            color: #2ed573;
        }
        
        .pending {
            color: #ffa502;
        }
        
        .overdue {
            color: #ff4757;
        }
        
        .btn {
            background: #2575fc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #1c60cb;
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #ddd;
        }
        
        .btn-danger {
            background: #ff4757;
            color: white;
        }
        
        .btn-danger:hover {
            background: #ff2e43;
        }
        
        .search-bar {
            display: flex;
            margin-bottom: 15px;
        }
        
        .search-bar input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-right: 10px;
        }
        
        .search-bar button {
            background: #2575fc;
            color: white;
            border: none;
            border-radius: 8px;
            width: 50px;
            cursor: pointer;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .cart-item-info {
            flex: 2;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .quantity-input {
            width: 40px;
            text-align: center;
            margin: 0 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 3px;
        }
        
        .cart-item-price {
            flex: 1;
            text-align: right;
            font-weight: 600;
            color: #2575fc;
        }
        
        .cart-total {
            font-size: 18px;
            font-weight: 700;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #2575fc;
            text-align: right;
        }
        
        .client-form, .product-form {
            margin-top: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2575fc;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }
        
        .empty-cart {
            text-align: center;
            padding: 20px;
            color: #888;
        }
        
        .empty-cart i {
            font-size: 48px;
            margin-bottom: 10px;
            color: #ddd;
        }
        
        .payment-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .payment-option.active {
            border-color: #2575fc;
            background-color: #f0f7ff;
        }
        
        .payment-option input {
            margin-right: 10px;
        }
        
        .due-date-container {
            display: none;
            margin-top: 10px;
        }
        
        .client-actions, .product-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .client-actions .btn, .product-actions .btn {
            margin-top: 0;
            width: auto;
            flex: 1;
        }

        .product-actions-small {
            display: flex;
            gap: 5px;
        }

        .product-actions-small i {
            cursor: pointer;
            font-size: 16px;
        }

        .fa-edit {
            color: #2575fc;
        }

        .fa-trash {
            color: #ff4757;
        }

        .receivable-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            width: auto;
        }
        
        /* NOVOS ESTILOS PARA OS RELATÓRIOS */
        .report-section {
            margin-top: 15px;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .report-title {
            font-size: 14px;
            font-weight: 600;
            color: #2575fc;
        }
        
        .report-view-all {
            font-size: 12px;
            color: #888;
            cursor: pointer;
        }
        
        .report-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f9f9f9;
        }
        
        .report-item:last-child {
            border-bottom: none;
        }
        
        .report-item-name {
            flex: 2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .report-item-value {
            flex: 1;
            text-align: right;
            font-weight: 600;
            color: #2575fc;
        }
        
        .report-empty {
            text-align: center;
            padding: 10px;
            color: #888;
            font-size: 12px;
        }
        
        .report-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .report-filter select {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-actions">
                <i class="fas fa-bell"></i>
                <i class="fas fa-cog"></i>
            </div>
            <h2>Business Control</h2>
            <div class="date-display">Segunda-feira, 25 de Setembro de 2023</div>
        </div>
        
        <div class="content">
            <!-- Dashboard Tab -->
            <div class="tab-content" id="dashboard">
                <div class="card">
                    <div class="card-title">
                        <span>Visão Geral</span>
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <p>Resumo do desempenho do seu negócio</p>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="today-sales">R$ 0,00</div>
                            <div class="stat-label">Vendas Hoje</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="month-sales">R$ 0,00</div>
                            <div class="stat-label">Vendas Mês</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="goal-percentage">0%</div>
                            <div class="stat-label">Meta</div>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="goal-progress" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- NOVA SEÇÃO: PRODUTOS MAIS VENDIDOS -->
                <div class="card">
                    <div class="card-title">
                        <span>Produtos Mais Vendidos</span>
                        <i class="fas fa-star"></i>
                    </div>
                    
                    <div class="report-section" id="top-products-section">
                        <div class="report-empty">
                            <p>Nenhuma venda registrada ainda</p>
                        </div>
                    </div>
                </div>
                
                <!-- NOVA SEÇÃO: MELHORES CLIENTES -->
                <div class="card">
                    <div class="card-title">
                        <span>Melhores Clientes</span>
                        <i class="fas fa-users"></i>
                    </div>
                    
                    <div class="report-section" id="top-clients-section">
                        <div class="report-empty">
                            <p>Nenhum cliente com compras registradas</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Próximos Recebimentos</span>
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div id="dashboard-receivables">
                        <div class="empty-cart">
                            <p>Nenhum recebimento pendente</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PDV Tab -->
            <div class="tab-content active" id="pdv">
                <div class="card">
                    <div class="card-title">
                        <span>Ponto de Venda</span>
                        <i class="fas fa-cash-register"></i>
                    </div>
                    
                    <div class="search-bar">
                        <input type="text" id="product-search" placeholder="Digite o código ou nome do produto">
                        <button id="search-product-btn"><i class="fas fa-search"></i></button>
                    </div>
                    
                    <h3>Produtos Disponíveis</h3>
                    <ul class="product-list" id="product-list">
                        <!-- Produtos carregados via JavaScript -->
                    </ul>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Carrinho de Compras</span>
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    
                    <div id="cart-items">
                        <div class="empty-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <p>Seu carrinho está vazio</p>
                        </div>
                    </div>
                    
                    <div class="cart-total" id="cart-total" style="display: none;">
                        Total: R$ <span id="total-value">0,00</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="client-select">Cliente</label>
                        <select id="client-select" class="form-control">
                            <option value="">Selecionar cliente...</option>
                            <!-- Clientes carregados via JavaScript -->
                        </select>
                    </div>
                    
                    <button class="btn" id="finalize-sale" disabled>Finalizar Venda</button>
                </div>
            </div>
            
            <!-- Estoque Tab -->
            <div class="tab-content" id="stock">
                <div class="card">
                    <div class="card-title">
                        <span>Controle de Estoque</span>
                        <i class="fas fa-boxes"></i>
                    </div>
                    
                    <div class="search-bar">
                        <input type="text" id="stock-search" placeholder="Buscar produto...">
                        <button id="stock-search-btn"><i class="fas fa-search"></i></button>
                    </div>
                    
                    <ul class="product-list" id="stock-list">
                        <!-- Produtos carregados via JavaScript -->
                    </ul>
                    
                    <button class="btn" id="add-product-btn">Adicionar Produto</button>
                </div>
                
                <div class="card" id="product-form-card" style="display: none;">
                    <div class="card-title">
                        <span id="product-form-title">Novo Produto</span>
                        <i class="fas fa-box"></i>
                    </div>
                    
                    <div class="product-form">
                        <input type="hidden" id="product-id">
                        <div class="form-group">
                            <label for="product-name">Nome do Produto</label>
                            <input type="text" id="product-name" placeholder="Nome do produto">
                        </div>
                        <div class="form-group">
                            <label for="product-code">Código</label>
                            <input type="text" id="product-code" placeholder="Código do produto">
                        </div>
                        <div class="form-group">
                            <label for="product-cost">Preço de Custo (R$)</label>
                            <input type="number" id="product-cost" placeholder="0.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="product-price">Preço de Venda (R$)</label>
                            <input type="number" id="product-price" placeholder="0.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="product-stock">Estoque</label>
                            <input type="number" id="product-stock" placeholder="0" min="0">
                        </div>
                        
                        <div class="product-actions">
                            <button class="btn btn-secondary" id="cancel-product">Cancelar</button>
                            <button class="btn" id="save-product">Salvar</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Clientes Tab -->
            <div class="tab-content" id="clients">
                <div class="card">
                    <div class="card-title">
                        <span>Gerenciamento de Clientes</span>
                        <i class="fas fa-users"></i>
                    </div>
                    
                    <div class="search-bar">
                        <input type="text" id="client-search" placeholder="Buscar cliente...">
                        <button id="client-search-btn"><i class="fas fa-search"></i></button>
                    </div>
                    
                    <ul class="client-list" id="client-list">
                        <!-- Clientes carregados via JavaScript -->
                    </ul>
                    
                    <button class="btn" id="add-client-btn">Adicionar Cliente</button>
                </div>
                
                <div class="card" id="client-form-card" style="display: none;">
                    <div class="card-title">
                        <span id="client-form-title">Novo Cliente</span>
                        <i class="fas fa-user-plus"></i>
                    </div>
                    
                    <div class="client-form">
                        <input type="hidden" id="client-id">
                        <div class="form-group">
                            <label for="client-name">Nome</label>
                            <input type="text" id="client-name" placeholder="Nome completo">
                        </div>
                        <div class="form-group">
                            <label for="client-email">E-mail</label>
                            <input type="email" id="client-email" placeholder="exemplo@email.com">
                        </div>
                        <div class="form-group">
                            <label for="client-phone">Telefone</label>
                            <input type="tel" id="client-phone" placeholder="(11) 99999-9999">
                        </div>
                        
                        <div class="client-actions">
                            <button class="btn btn-secondary" id="cancel-client">Cancelar</button>
                            <button class="btn" id="save-client">Salvar</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Receivables Tab -->
            <div class="tab-content" id="receivables">
                <div class="card">
                    <div class="card-title">
                        <span>Vendas a Receber</span>
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    
                    <ul class="client-list" id="receivables-list">
                        <!-- Vendas a receber carregadas via JavaScript -->
                    </ul>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="to-receive-value">R$ 0,00</div>
                            <div class="stat-label">A Vencer</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="overdue-value">R$ 0,00</div>
                            <div class="stat-label">Atrasado</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-receivables">R$ 0,00</div>
                            <div class="stat-label">Total</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- NOVA ABA: Relatórios -->
            <div class="tab-content" id="reports">
                <div class="card">
                    <div class="card-title">
                        <span>Relatórios Detalhados</span>
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    
                    <div class="report-filter">
                        <select id="report-period">
                            <option value="today">Hoje</option>
                            <option value="week">Esta Semana</option>
                            <option value="month" selected>Este Mês</option>
                            <option value="all">Todos</option>
                        </select>
                        
                        <select id="report-type">
                            <option value="products">Produtos</option>
                            <option value="clients">Clientes</option>
                            <option value="sales">Vendas</option>
                        </select>
                    </div>
                    
                    <div id="detailed-report">
                        <div class="empty-cart">
                            <p>Selecione o tipo de relatório</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="nav">
            <div class="nav-item" data-tab="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item active" data-tab="pdv">
                <i class="fas fa-cash-register"></i>
                <span>PDV</span>
            </div>
            <div class="nav-item" data-tab="stock">
                <i class="fas fa-boxes"></i>
                <span>Estoque</span>
            </div>
            <div class="nav-item" data-tab="clients">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </div>
            <div class="nav-item" data-tab="receivables">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>A Receber</span>
            </div>
            <div class="nav-item" data-tab="reports">
                <i class="fas fa-chart-bar"></i>
                <span>Relatórios</span>
            </div>
        </div>
    </div>

    <!-- Modal de Finalização de Venda -->
    <div class="modal" id="sale-modal">
        <div class="modal-content">
            <div class="modal-title">Resumo da Venda</div>
            
            <div id="sale-summary">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
            
            <div class="form-group">
                <label>Forma de Pagamento</label>
                
                <div class="payment-option active" id="cash-option">
                    <input type="radio" name="payment-method" value="cash" checked>
                    <label for="cash">À Vista</label>
                </div>
                
                <div class="payment-option" id="term-option">
                    <input type="radio" name="payment-method" value="term">
                    <label for="term">A Prazo</label>
                </div>
                
                <div class="due-date-container" id="due-date-container">
                    <div class="form-group">
                        <label for="due-date">Data de Vencimento</label>
                        <input type="date" id="due-date">
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-sale">Cancelar</button>
                <button class="btn" id="confirm-sale">Confirmar Venda</button>
            </div>
        </div>
    </div>

    <script>
        // Dados da aplicação
        let cart = [];
        let total = 0;
        let clients = [
            { id: 1, name: "João Silva", email: "joao@email.com", phone: "(11) 99999-9999", totalPurchases: 0 },
            { id: 2, name: "Maria Santos", email: "maria@email.com", phone: "(11) 98888-8888", totalPurchases: 0 },
            { id: 3, name: "Empresa ABC", email: "contato@empresa.com", phone: "(11) 97777-7777", totalPurchases: 0 }
        ];
        
        let products = []; // Inicialmente vazio - será preenchido pelo usuário
        
        // NOVO: Histórico de vendas para relatórios
        let salesHistory = [];
        
        let receivables = []; // Inicialmente vazio - será preenchido com vendas a prazo
        
        // Dados de vendas para dashboard
        let sales = {
            today: 0,
            month: 0,
            goal: 30000 // Meta mensal de R$ 30.000
        };
        
        // Elementos do DOM
        const productList = document.getElementById('product-list');
        const stockList = document.getElementById('stock-list');
        const cartItems = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        const totalValue = document.getElementById('total-value');
        const clientSelect = document.getElementById('client-select');
        const finalizeSaleBtn = document.getElementById('finalize-sale');
        const saleModal = document.getElementById('sale-modal');
        const saleSummary = document.getElementById('sale-summary');
        const cancelSaleBtn = document.getElementById('cancel-sale');
        const confirmSaleBtn = document.getElementById('confirm-sale');
        const clientList = document.getElementById('client-list');
        const addClientBtn = document.getElementById('add-client-btn');
        const clientFormCard = document.getElementById('client-form-card');
        const clientFormTitle = document.getElementById('client-form-title');
        const cancelClientBtn = document.getElementById('cancel-client');
        const saveClientBtn = document.getElementById('save-client');
        const clientIdInput = document.getElementById('client-id');
        const clientNameInput = document.getElementById('client-name');
        const clientEmailInput = document.getElementById('client-email');
        const clientPhoneInput = document.getElementById('client-phone');
        const receivablesList = document.getElementById('receivables-list');
        const cashOption = document.getElementById('cash-option');
        const termOption = document.getElementById('term-option');
        const dueDateContainer = document.getElementById('due-date-container');
        const dueDateInput = document.getElementById('due-date');
        const addProductBtn = document.getElementById('add-product-btn');
        const productFormCard = document.getElementById('product-form-card');
        const productFormTitle = document.getElementById('product-form-title');
        const cancelProductBtn = document.getElementById('cancel-product');
        const saveProductBtn = document.getElementById('save-product');
        const productIdInput = document.getElementById('product-id');
        const productNameInput = document.getElementById('product-name');
        const productCodeInput = document.getElementById('product-code');
        const productCostInput = document.getElementById('product-cost');
        const productPriceInput = document.getElementById('product-price');
        const productStockInput = document.getElementById('product-stock');
        const productSearchInput = document.getElementById('product-search');
        const searchProductBtn = document.getElementById('search-product-btn');
        const stockSearchInput = document.getElementById('stock-search');
        const stockSearchBtn = document.getElementById('stock-search-btn');
        const clientSearchInput = document.getElementById('client-search');
        const clientSearchBtn = document.getElementById('client-search-btn');
        const todaySalesElement = document.getElementById('today-sales');
        const monthSalesElement = document.getElementById('month-sales');
        const goalPercentageElement = document.getElementById('goal-percentage');
        const goalProgressElement = document.getElementById('goal-progress');
        const dashboardReceivables = document.getElementById('dashboard-receivables');
        const toReceiveValueElement = document.getElementById('to-receive-value');
        const overdueValueElement = document.getElementById('overdue-value');
        const totalReceivablesElement = document.getElementById('total-receivables');
        
        // NOVOS ELEMENTOS: Relatórios
        const topProductsSection = document.getElementById('top-products-section');
        const topClientsSection = document.getElementById('top-clients-section');
        const reportPeriod = document.getElementById('report-period');
        const reportType = document.getElementById('report-type');
        const detailedReport = document.getElementById('detailed-report');
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            loadClients();
            loadProducts();
            loadReceivables();
            updateDashboard();
            setupEventListeners();
            updateDateTime();
            
            // Definir data mínima para o datepicker (hoje)
            const today = new Date().toISOString().split('T')[0];
            dueDateInput.setAttribute('min', today);
            
            // Adicionar event listeners para os relatórios
            reportPeriod.addEventListener('change', generateReport);
            reportType.addEventListener('change', generateReport);
        });
        
        // Carregar clientes nos selects e listas
        function loadClients() {
            // Limpar selects e listas
            clientSelect.innerHTML = '<option value="">Selecionar cliente...</option>';
            clientList.innerHTML = '';
            
            // Adicionar clientes ao select
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                clientSelect.appendChild(option);
            });
            
            // Adicionar clientes à lista
            clients.forEach(client => {
                const li = document.createElement('li');
                li.className = 'client-item';
                li.innerHTML = `
                    <div class="client-info">
                        <strong>${client.name}</strong>
                        <div>${client.email} | ${client.phone}</div>
                        <div>Total em compras: R$ ${client.totalPurchases.toFixed(2)}</div>
                    </div>
                    <div class="client-actions">
                        <i class="fas fa-edit edit-client" data-id="${client.id}"></i>
                        <i class="fas fa-trash delete-client" data-id="${client.id}"></i>
                    </div>
                `;
                clientList.appendChild(li);
            });
            
            // Adicionar event listeners para editar e excluir
            document.querySelectorAll('.edit-client').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const clientId = this.getAttribute('data-id');
                    editClient(clientId);
                });
            });
            
            document.querySelectorAll('.delete-client').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const clientId = this.getAttribute('data-id');
                    deleteClient(clientId);
                });
            });
        }
        
        // Carregar produtos
        function loadProducts() {
            productList.innerHTML = '';
            stockList.innerHTML = '';
            
            if (products.length === 0) {
                productList.innerHTML = '<div class="empty-cart"><p>Nenhum produto cadastrado</p></div>';
                stockList.innerHTML = '<div class="empty-cart"><p>Nenhum produto cadastrado</p></div>';
                return;
            }
            
            // Adicionar produtos à lista do PDV
            products.forEach(product => {
                const li = document.createElement('li');
                li.className = 'product-item';
                li.setAttribute('data-id', product.id);
                li.setAttribute('data-name', product.name);
                li.setAttribute('data-price', product.price);
                li.innerHTML = `
                    <div class="product-info">
                        <strong>${product.name}</strong>
                        <div>R$ ${product.price.toFixed(2)} | Cód: ${product.code}</div>
                    </div>
                    <div class="product-stock ${product.stock <= 5 ? 'low-stock' : ''}">Estoque: ${product.stock}</div>
                `;
                productList.appendChild(li);
            });
            
            // Adicionar produtos à lista de estoque
            products.forEach(product => {
                const li = document.createElement('li');
                li.className = 'product-item';
                li.innerHTML = `
                    <div class="product-info">
                        <strong>${product.name}</strong>
                        <div>Cód: ${product.code} | R$ ${product.price.toFixed(2)}</div>
                        <div>Custo: R$ ${product.cost.toFixed(2)} | Margem: ${calculateMargin(product.cost, product.price)}%</div>
                    </div>
                    <div class="product-stock ${product.stock <= 5 ? 'low-stock' : ''}">
                        ${product.stock} unid.
                        <div class="product-actions-small">
                            <i class="fas fa-edit edit-product" data-id="${product.id}"></i>
                            <i class="fas fa-trash delete-product" data-id="${product.id}"></i>
                        </div>
                    </div>
                `;
                stockList.appendChild(li);
            });
            
            // Adicionar event listeners para editar e excluir produtos
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const productId = this.getAttribute('data-id');
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const productId = this.getAttribute('data-id');
                    deleteProduct(productId);
                });
            });
        }
        
        // Calcular margem de lucro
        function calculateMargin(cost, price) {
            if (cost === 0) return 100;
            return (((price - cost) / cost) * 100).toFixed(2);
        }
        
        // Carregar vendas a receber
        function loadReceivables() {
            receivablesList.innerHTML = '';
            
            if (receivables.length === 0) {
                receivablesList.innerHTML = '<div class="empty-cart"><p>Nenhuma venda a receber</p></div>';
                toReceiveValueElement.textContent = 'R$ 0,00';
                overdueValueElement.textContent = 'R$ 0,00';
                totalReceivablesElement.textContent = 'R$ 0,00';
                return;
            }
            
            let toReceiveTotal = 0;
            let overdueTotal = 0;
            let totalReceivables = 0;
            
            receivables.forEach(item => {
                // Verificar status
                const today = new Date();
                const dueDate = new Date(item.dueDate);
                let status = 'pending';
                let statusClass = 'pending';
                
                if (item.status === 'paid') {
                    status = 'paid';
                    statusClass = 'paid';
                } else if (dueDate < today) {
                    status = 'overdue';
                    statusClass = 'overdue';
                    overdueTotal += item.value;
                } else {
                    toReceiveTotal += item.value;
                }
                
                totalReceivables += item.value;
                
                // Formatar data
                const formattedDate = dueDate.toLocaleDateString('pt-BR');
                
                const li = document.createElement('li');
                li.className = 'client-item';
                li.innerHTML = `
                    <div class="client-info">
                        <strong>${item.client}</strong>
                        <div>Vencimento: ${formattedDate}</div>
                        ${status !== 'paid' ? `
                        <div class="receivable-actions">
                            <button class="btn btn-small receive-payment" data-id="${item.id}">Receber</button>
                        </div>
                        ` : ''}
                    </div>
                    <div class="client-value ${statusClass}">R$ ${item.value.toFixed(2)}</div>
                `;
                receivablesList.appendChild(li);
            });
            
            // Atualizar totais
            toReceiveValueElement.textContent = `R$ ${toReceiveTotal.toFixed(2)}`;
            overdueValueElement.textContent = `R$ ${overdueTotal.toFixed(2)}`;
            totalReceivablesElement.textContent = `R$ ${totalReceivables.toFixed(2)}`;
            
            // Adicionar event listeners para o botão de receber
            document.querySelectorAll('.receive-payment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const receivableId = this.getAttribute('data-id');
                    receivePayment(receivableId);
                });
            });
        }
        
        // Atualizar dashboard
        function updateDashboard() {
            // Atualizar vendas
            todaySalesElement.textContent = `R$ ${sales.today.toFixed(2)}`;
            monthSalesElement.textContent = `R$ ${sales.month.toFixed(2)}`;
            
            // Calcular porcentagem da meta
            const goalPercentage = sales.month > 0 ? Math.min(100, (sales.month / sales.goal) * 100) : 0;
            goalPercentageElement.textContent = `${goalPercentage.toFixed(0)}%`;
            goalProgressElement.style.width = `${goalPercentage}%`;
            
            // Atualizar recebíveis no dashboard
            updateDashboardReceivables();
            
            // Atualizar relatórios
            updateTopProductsReport();
            updateTopClientsReport();
        }
        
        // Atualizar recebíveis no dashboard
        function updateDashboardReceivables() {
            dashboardReceivables.innerHTML = '';
            
            // Filtrar apenas recebíveis pendentes e vencidos
            const pendingReceivables = receivables.filter(item => {
                if (item.status === 'paid') return false;
                
                const dueDate = new Date(item.dueDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // Mostrar apenas os que vencem nos próximos 7 dias ou estão atrasados
                const diffTime = dueDate.getTime() - today.getTime();
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                return diffDays <= 7 || dueDate < today;
            });
            
            if (pendingReceivables.length === 0) {
                dashboardReceivables.innerHTML = '<div class="empty-cart"><p>Nenhum recebimento pendente</p></div>';
                return;
            }
            
            // Ordenar por data de vencimento (mais próximos primeiro)
            pendingReceivables.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            
            // Mostrar apenas os 3 mais próximos
            const recentReceivables = pendingReceivables.slice(0, 3);
            
            recentReceivables.forEach(item => {
                const dueDate = new Date(item.dueDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let statusClass = 'pending';
                let statusText = 'A Vencer';
                
                if (dueDate < today) {
                    statusClass = 'overdue';
                    statusText = 'Atrasado';
                }
                
                const formattedDate = dueDate.toLocaleDateString('pt-BR');
                
                const saleItem = document.createElement('div');
                saleItem.className = 'sale-item';
                saleItem.innerHTML = `
                    <div class="sale-info">
                        <strong>${item.client}</strong>
                        <div>Venc: ${formattedDate}</div>
                    </div>
                    <div class="sale-value ${statusClass}">
                        R$ ${item.value.toFixed(2)}
                        <div style="font-size: 12px;">${statusText}</div>
                    </div>
                `;
                dashboardReceivables.appendChild(saleItem);
            });
        }
        
        // NOVA FUNÇÃO: Atualizar relatório de produtos mais vendidos
        function updateTopProductsReport() {
            // Calcular totais de vendas por produto
            const productSales = {};
            
            salesHistory.forEach(sale => {
                sale.items.forEach(item => {
                    if (!productSales[item.id]) {
                        productSales[item.id] = {
                            id: item.id,
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    
                    productSales[item.id].quantity += item.quantity;
                    productSales[item.id].revenue += item.price * item.quantity;
                });
            });
            
            // Converter para array e ordenar por quantidade vendida
            const topProducts = Object.values(productSales)
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5); // Top 5 produtos
            
            // Atualizar a interface
            topProductsSection.innerHTML = '';
            
            if (topProducts.length === 0) {
                topProductsSection.innerHTML = '<div class="report-empty"><p>Nenhuma venda registrada ainda</p></div>';
                return;
            }
            
            topProducts.forEach((product, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'report-item';
                itemElement.innerHTML = `
                    <div class="report-item-name">${index + 1}. ${product.name}</div>
                    <div class="report-item-value">${product.quantity} un</div>
                `;
                topProductsSection.appendChild(itemElement);
            });
        }
        
        // NOVA FUNÇÃO: Atualizar relatório de melhores clientes
        function updateTopClientsReport() {
            // Ordenar clientes por valor total de compras
            const topClients = [...clients]
                .filter(client => client.totalPurchases > 0)
                .sort((a, b) => b.totalPurchases - a.totalPurchases)
                .slice(0, 5); // Top 5 clientes
            
            // Atualizar a interface
            topClientsSection.innerHTML = '';
            
            if (topClients.length === 0) {
                topClientsSection.innerHTML = '<div class="report-empty"><p>Nenhum cliente com compras registradas</p></div>';
                return;
            }
            
            topClients.forEach((client, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'report-item';
                itemElement.innerHTML = `
                    <div class="report-item-name">${index + 1}. ${client.name}</div>
                    <div class="report-item-value">R$ ${client.totalPurchases.toFixed(2)}</div>
                `;
                topClientsSection.appendChild(itemElement);
            });
        }
        
        // NOVA FUNÇÃO: Gerar relatório detalhado
        function generateReport() {
            const period = reportPeriod.value;
            const type = reportType.value;
            
            detailedReport.innerHTML = '';
            
            // Filtrar vendas pelo período selecionado
            let filteredSales = [];
            const today = new Date();
            
            switch(period) {
                case 'today':
                    filteredSales = salesHistory.filter(sale => {
                        const saleDate = new Date(sale.date);
                        return saleDate.toDateString() === today.toDateString();
                    });
                    break;
                    
                case 'week':
                    const oneWeekAgo = new Date();
                    oneWeekAgo.setDate(today.getDate() - 7);
                    
                    filteredSales = salesHistory.filter(sale => {
                        const saleDate = new Date(sale.date);
                        return saleDate >= oneWeekAgo;
                    });
                    break;
                    
                case 'month':
                    filteredSales = salesHistory.filter(sale => {
                        const saleDate = new Date(sale.date);
                        return saleDate.getMonth() === today.getMonth() && 
                               saleDate.getFullYear() === today.getFullYear();
                    });
                    break;
                    
                case 'all':
                    filteredSales = [...salesHistory];
                    break;
            }
            
            if (filteredSales.length === 0) {
                detailedReport.innerHTML = '<div class="report-empty"><p>Nenhum dado encontrado para o período selecionado</p></div>';
                return;
            }
            
            // Gerar relatório com base no tipo selecionado
            if (type === 'products') {
                generateProductReport(filteredSales);
            } else if (type === 'clients') {
                generateClientReport(filteredSales);
            } else if (type === 'sales') {
                generateSalesReport(filteredSales);
            }
        }
        
        // NOVA FUNÇÃO: Gerar relatório de produtos
        function generateProductReport(sales) {
            const productSales = {};
            
            sales.forEach(sale => {
                sale.items.forEach(item => {
                    if (!productSales[item.id]) {
                        productSales[item.id] = {
                            id: item.id,
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    
                    productSales[item.id].quantity += item.quantity;
                    productSales[item.id].revenue += item.price * item.quantity;
                });
            });
            
            const productsArray = Object.values(productSales)
                .sort((a, b) => b.revenue - a.revenue);
            
            const totalRevenue = productsArray.reduce((sum, product) => sum + product.revenue, 0);
            
            let reportHTML = `
                <div class="report-header">
                    <div class="report-title">Produtos Vendidos</div>
                    <div class="report-item-value">R$ ${totalRevenue.toFixed(2)}</div>
                </div>
            `;
            
            productsArray.forEach(product => {
                const percentage = ((product.revenue / totalRevenue) * 100).toFixed(1);
                
                reportHTML += `
                    <div class="report-item">
                        <div class="report-item-name">${product.name}</div>
                        <div class="report-item-value">
                            ${product.quantity} un<br>
                            <small>R$ ${product.revenue.toFixed(2)} (${percentage}%)</small>
                        </div>
                    </div>
                `;
            });
            
            detailedReport.innerHTML = reportHTML;
        }
        
        // NOVA FUNÇÃO: Gerar relatório de clientes
        function generateClientReport(sales) {
            const clientSales = {};
            
            sales.forEach(sale => {
                if (sale.clientId) {
                    if (!clientSales[sale.clientId]) {
                        clientSales[sale.clientId] = {
                            id: sale.clientId,
                            name: sale.clientName,
                            count: 0,
                            revenue: 0
                        };
                    }
                    
                    clientSales[sale.clientId].count += 1;
                    clientSales[sale.clientId].revenue += sale.total;
                }
            });
            
            const clientsArray = Object.values(clientSales)
                .sort((a, b) => b.revenue - a.revenue);
                
            const totalRevenue = clientsArray.reduce((sum, client) => sum + client.revenue, 0);
            
            let reportHTML = `
                <div class="report-header">
                    <div class="report-title">Clientes</div>
                    <div class="report-item-value">R$ ${totalRevenue.toFixed(2)}</div>
                </div>
            `;
            
            clientsArray.forEach(client => {
                const percentage = ((client.revenue / totalRevenue) * 100).toFixed(1);
                
                reportHTML += `
                    <div class="report-item">
                        <div class="report-item-name">${client.name}</div>
                        <div class="report-item-value">
                            ${client.count} compras<br>
                            <small>R$ ${client.revenue.toFixed(2)} (${percentage}%)</small>
                        </div>
                    </div>
                `;
            });
            
            detailedReport.innerHTML = reportHTML;
        }
        
        // NOVA FUNÇÃO: Gerar relatório de vendas
        function generateSalesReport(sales) {
            const dailySales = {};
            
            sales.forEach(sale => {
                const saleDate = new Date(sale.date).toLocaleDateString('pt-BR');
                
                if (!dailySales[saleDate]) {
                    dailySales[saleDate] = {
                        date: saleDate,
                        count: 0,
                        revenue: 0
                    };
                }
                
                dailySales[saleDate].count += 1;
                dailySales[saleDate].revenue += sale.total;
            });
            
            const dailyArray = Object.values(dailySales)
                .sort((a, b) => new Date(b.date.split('/').reverse().join('-')) - new Date(a.date.split('/').reverse().join('-')));
                
            const totalRevenue = dailyArray.reduce((sum, day) => sum + day.revenue, 0);
            const totalSales = dailyArray.reduce((sum, day) => sum + day.count, 0);
            
            let reportHTML = `
                <div class="report-header">
                    <div class="report-title">Vendas por Dia</div>
                    <div class="report-item-value">${totalSales} vendas</div>
                </div>
                <div class="report-header">
                    <div class="report-title">Total Período</div>
                    <div class="report-item-value">R$ ${totalRevenue.toFixed(2)}</div>
                </div>
            `;
            
            dailyArray.forEach(day => {
                reportHTML += `
                    <div class="report-item">
                        <div class="report-item-name">${day.date}</div>
                        <div class="report-item-value">
                            ${day.count} vendas<br>
                            <small>R$ ${day.revenue.toFixed(2)}</small>
                        </div>
                    </div>
                `;
            });
            
            detailedReport.innerHTML = reportHTML;
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            // Navegação por abas
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    
                    // Ativar aba clicada
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Mostrar conteúdo correspondente
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tab).classList.add('active');
                    
                    // Se for a aba de relatórios, gerar o relatório
                    if (tab === 'reports') {
                        generateReport();
                    }
                });
            });
            
            // Adicionar produto ao carrinho
            productList.addEventListener('click', function(e) {
                const productItem = e.target.closest('.product-item');
                if (productItem) {
                    const productId = parseInt(productItem.getAttribute('data-id'));
                    const productName = productItem.getAttribute('data-name');
                    const productPrice = parseFloat(productItem.getAttribute('data-price'));
                    
                    // Verificar se o produto já está no carrinho
                    const existingItem = cart.find(item => item.id === productId);
                    
                    if (existingItem) {
                        // Verificar se há estoque disponível
                        const product = products.find(p => p.id === productId);
                        if (existingItem.quantity < product.stock) {
                            existingItem.quantity++;
                        } else {
                            alert('Estoque insuficiente para este produto!');
                        }
                    } else {
                        // Verificar se há estoque disponível
                        const product = products.find(p => p.id === productId);
                        if (product.stock > 0) {
                            cart.push({
                                id: productId,
                                name: productName,
                                price: productPrice,
                                quantity: 1
                            });
                        } else {
                            alert('Produto sem estoque disponível!');
                        }
                    }
                    
                    updateCart();
                }
            });
            
            // Finalizar venda
            finalizeSaleBtn.addEventListener('click', function() {
                if (cart.length === 0) return;
                
                // Criar resumo da venda
                let summaryHTML = '<div class="sale-summary">';
                cart.forEach(item => {
                    summaryHTML += `
                        <div class="sale-item">
                            <div class="sale-info">${item.name} x ${item.quantity}</div>
                            <div class="sale-value">R$ ${(item.price * item.quantity).toFixed(2)}</div>
                        </div>
                    `;
                });
                summaryHTML += `
                    <div class="cart-total">
                        Total: R$ ${total.toFixed(2)}
                    </div>
                `;
                
                // Adicionar informações do cliente se selecionado
                const clientId = clientSelect.value;
                if (clientId) {
                    const client = clients.find(c => c.id === parseInt(clientId));
                    summaryHTML += `<p><strong>Cliente:</strong> ${client.name}</p>`;
                }
                
                summaryHTML += '</div>';
                
                saleSummary.innerHTML = summaryHTML;
                
                // Mostrar modal
                saleModal.style.display = 'flex';
            });
            
            // Opções de pagamento
            cashOption.addEventListener('click', function() {
                cashOption.classList.add('active');
                termOption.classList.remove('active');
                document.querySelector('input[name="payment-method"][value="cash"]').checked = true;
                dueDateContainer.style.display = 'none';
            });
            
            termOption.addEventListener('click', function() {
                termOption.classList.add('active');
                cashOption.classList.remove('active');
                document.querySelector('input[name="payment-method"][value="term"]').checked = true;
                dueDateContainer.style.display = 'block';
            });
            
            // Confirmar venda
            confirmSaleBtn.addEventListener('click', function() {
                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                const clientId = clientSelect.value;
                const clientName = clientId ? clients.find(c => c.id === parseInt(clientId)).name : 'Cliente não identificado';
                
                if (paymentMethod === 'term') {
                    const dueDate = dueDateInput.value;
                    if (!dueDate) {
                        alert('Por favor, selecione uma data de vencimento para vendas a prazo.');
                        return;
                    }
                    
                    // Adicionar à lista de recebíveis
                    const receivableId = receivables.length > 0 ? Math.max(...receivables.map(r => r.id)) + 1 : 1;
                    receivables.push({
                        id: receivableId,
                        client: clientName,
                        value: total,
                        dueDate: dueDate,
                        status: 'pending'
                    });
                }
                
                // NOVO: Registrar venda no histórico
                const saleId = salesHistory.length > 0 ? Math.max(...salesHistory.map(s => s.id)) + 1 : 1;
                const saleDate = new Date().toISOString();
                
                salesHistory.push({
                    id: saleId,
                    date: saleDate,
                    clientId: clientId ? parseInt(clientId) : null,
                    clientName: clientName,
                    items: [...cart],
                    total: total,
                    paymentMethod: paymentMethod
                });
                
                // NOVO: Atualizar total de compras do cliente
                if (clientId) {
                    const client = clients.find(c => c.id === parseInt(clientId));
                    if (client) {
                        client.totalPurchases += total;
                    }
                }
                
                // Atualizar estoque
                updateStockAfterSale();
                
                // Atualizar vendas
                const saleValue = total;
                sales.today += saleValue;
                sales.month += saleValue;
                
                // Limpar carrinho
                cart = [];
                updateCart();
                
                // Fechar modal
                saleModal.style.display = 'none';
                
                // Recarregar dados
                loadProducts();
                loadReceivables();
                updateDashboard();
                
                // Resetar seleção de cliente
                clientSelect.value = '';
                
                alert('Venda finalizada com sucesso!');
            });
            
            // Cancelar venda
            cancelSaleBtn.addEventListener('click', function() {
                saleModal.style.display = 'none';
            });
            
            // Clientes - Adicionar/Editar
            addClientBtn.addEventListener('click', function() {
                clientFormTitle.textContent = 'Novo Cliente';
                clientIdInput.value = '';
                clientNameInput.value = '';
                clientEmailInput.value = '';
                clientPhoneInput.value = '';
                clientFormCard.style.display = 'block';
            });
            
            cancelClientBtn.addEventListener('click', function() {
                clientFormCard.style.display = 'none';
            });
            
            saveClientBtn.addEventListener('click', function() {
                const id = clientIdInput.value;
                const name = clientNameInput.value;
                const email = clientEmailInput.value;
                const phone = clientPhoneInput.value;
                
                if (!name) {
                    alert('Por favor, preencha o nome do cliente.');
                    return;
                }
                
                if (id) {
                    // Editar cliente existente
                    const index = clients.findIndex(c => c.id === parseInt(id));
                    if (index !== -1) {
                        clients[index] = { 
                            id: parseInt(id), 
                            name, 
                            email, 
                            phone, 
                            totalPurchases: clients[index].totalPurchases 
                        };
                    }
                } else {
                    // Adicionar novo cliente
                    const newId = clients.length > 0 ? Math.max(...clients.map(c => c.id)) + 1 : 1;
                    clients.push({ id: newId, name, email, phone, totalPurchases: 0 });
                }
                
                loadClients();
                clientFormCard.style.display = 'none';
            });
            
            // Produtos - Adicionar/Editar
            addProductBtn.addEventListener('click', function() {
                productFormTitle.textContent = 'Novo Produto';
                productIdInput.value = '';
                productNameInput.value = '';
                productCodeInput.value = '';
                productCostInput.value = '';
                productPriceInput.value = '';
                productStockInput.value = '';
                productFormCard.style.display = 'block';
            });
            
            cancelProductBtn.addEventListener('click', function() {
                productFormCard.style.display = 'none';
            });
            
            saveProductBtn.addEventListener('click', function() {
                const id = productIdInput.value;
                const name = productNameInput.value;
                const code = productCodeInput.value;
                const cost = parseFloat(productCostInput.value) || 0;
                const price = parseFloat(productPriceInput.value) || 0;
                const stock = parseInt(productStockInput.value) || 0;
                
                if (!name || !code) {
                    alert('Por favor, preencha pelo menos o nome e código do produto.');
                    return;
                }
                
                if (id) {
                    // Editar produto existente
                    const index = products.findIndex(p => p.id === parseInt(id));
                    if (index !== -1) {
                        products[index] = { id: parseInt(id), name, code, cost, price, stock };
                    }
                } else {
                    // Adicionar novo produto
                    const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                    products.push({ id: newId, name, code, cost, price, stock });
                }
                
                loadProducts();
                productFormCard.style.display = 'none';
            });
            
            // Buscar produtos
            searchProductBtn.addEventListener('click', searchProducts);
            productSearchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchProducts();
            });
            
            // Buscar estoque
            stockSearchBtn.addEventListener('click', searchStock);
            stockSearchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchStock();
            });
            
            // Buscar clientes
            clientSearchBtn.addEventListener('click', searchClients);
            clientSearchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchClients();
            });
        }
        
        // Atualizar carrinho
        function updateCart() {
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="empty-cart"><i class="fas fa-shopping-cart"></i><p>Seu carrinho está vazio</p></div>';
                cartTotal.style.display = 'none';
                finalizeSaleBtn.disabled = true;
                total = 0;
                return;
            }
            
            total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <strong>${item.name}</strong>
                        <div>R$ ${item.price.toFixed(2)}</div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" data-id="${item.id}">
                            <button class="quantity-btn increase" data-id="${item.id}">+</button>
                        </div>
                    </div>
                    <div class="cart-item-price">
                        R$ ${itemTotal.toFixed(2)}
                        <div style="margin-top: 5px;">
                            <i class="fas fa-trash remove-item" data-id="${item.id}" style="color: #ff4757; cursor: pointer;"></i>
                        </div>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            totalValue.textContent = total.toFixed(2);
            cartTotal.style.display = 'block';
            finalizeSaleBtn.disabled = false;
            
            // Adicionar event listeners para os botões de quantidade
            document.querySelectorAll('.increase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const cartItem = cart.find(item => item.id === productId);
                    
                    // Verificar se há estoque disponível
                    const product = products.find(p => p.id === productId);
                    if (cartItem.quantity < product.stock) {
                        cartItem.quantity++;
                        updateCart();
                    } else {
                        alert('Estoque insuficiente para este produto!');
                    }
                });
            });
            
            document.querySelectorAll('.decrease').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const cartItem = cart.find(item => item.id === productId);
                    
                    if (cartItem.quantity > 1) {
                        cartItem.quantity--;
                        updateCart();
                    }
                });
            });
            
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('change', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const cartItem = cart.find(item => item.id === productId);
                    const newQuantity = parseInt(this.value) || 1;
                    
                    // Verificar se há estoque disponível
                    const product = products.find(p => p.id === productId);
                    if (newQuantity <= product.stock) {
                        cartItem.quantity = newQuantity;
                        updateCart();
                    } else {
                        alert('Estoque insuficiente para este produto!');
                        this.value = cartItem.quantity;
                    }
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    cart = cart.filter(item => item.id !== productId);
                    updateCart();
                });
            });
        }
        
        // Atualizar estoque após venda
        function updateStockAfterSale() {
            cart.forEach(cartItem => {
                const product = products.find(p => p.id === cartItem.id);
                if (product) {
                    product.stock -= cartItem.quantity;
                    if (product.stock < 0) product.stock = 0;
                }
            });
        }
        
        // Editar cliente
        function editClient(clientId) {
            const client = clients.find(c => c.id === parseInt(clientId));
            if (client) {
                clientFormTitle.textContent = 'Editar Cliente';
                clientIdInput.value = client.id;
                clientNameInput.value = client.name;
                clientEmailInput.value = client.email;
                clientPhoneInput.value = client.phone;
                clientFormCard.style.display = 'block';
            }
        }
        
        // Excluir cliente
        function deleteClient(clientId) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                clients = clients.filter(c => c.id !== parseInt(clientId));
                loadClients();
            }
        }
        
        // Editar produto
        function editProduct(productId) {
            const product = products.find(p => p.id === parseInt(productId));
            if (product) {
                productFormTitle.textContent = 'Editar Produto';
                productIdInput.value = product.id;
                productNameInput.value = product.name;
                productCodeInput.value = product.code;
                productCostInput.value = product.cost;
                productPriceInput.value = product.price;
                productStockInput.value = product.stock;
                productFormCard.style.display = 'block';
            }
        }
        
        // Excluir produto
        function deleteProduct(productId) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                products = products.filter(p => p.id !== parseInt(productId));
                loadProducts();
            }
        }
        
        // Receber pagamento
        function receivePayment(receivableId) {
            if (confirm('Deseja marcar este recebível como pago?')) {
                const receivable = receivables.find(r => r.id === parseInt(receivableId));
                if (receivable) {
                    receivable.status = 'paid';
                    loadReceivables();
                    updateDashboardReceivables();
                }
            }
        }
        
        // Buscar produtos
        function searchProducts() {
            const searchTerm = productSearchInput.value.toLowerCase();
            
            if (!searchTerm) {
                loadProducts();
                return;
            }
            
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) || 
                product.code.toLowerCase().includes(searchTerm)
            );
            
            productList.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                productList.innerHTML = '<div class="empty-cart"><p>Nenhum produto encontrado</p></div>';
                return;
            }
            
            filteredProducts.forEach(product => {
                const li = document.createElement('li');
                li.className = 'product-item';
                li.setAttribute('data-id', product.id);
                li.setAttribute('data-name', product.name);
                li.setAttribute('data-price', product.price);
                li.innerHTML = `
                    <div class="product-info">
                        <strong>${product.name}</strong>
                        <div>R$ ${product.price.toFixed(2)} | Cód: ${product.code}</div>
                    </div>
                    <div class="product-stock ${product.stock <= 5 ? 'low-stock' : ''}">Estoque: ${product.stock}</div>
                `;
                productList.appendChild(li);
            });
        }
        
        // Buscar estoque
        function searchStock() {
            const searchTerm = stockSearchInput.value.toLowerCase();
            
            if (!searchTerm) {
                loadProducts();
                return;
            }
            
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) || 
                product.code.toLowerCase().includes(searchTerm)
            );
            
            stockList.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                stockList.innerHTML = '<div class="empty-cart"><p>Nenhum produto encontrado</p></div>';
                return;
            }
            
            filteredProducts.forEach(product => {
                const li = document.createElement('li');
                li.className = 'product-item';
                li.innerHTML = `
                    <div class="product-info">
                        <strong>${product.name}</strong>
                        <div>Cód: ${product.code} | R$ ${product.price.toFixed(2)}</div>
                        <div>Custo: R$ ${product.cost.toFixed(2)} | Margem: ${calculateMargin(product.cost, product.price)}%</div>
                    </div>
                    <div class="product-stock ${product.stock <= 5 ? 'low-stock' : ''}">
                        ${product.stock} unid.
                        <div class="product-actions-small">
                            <i class="fas fa-edit edit-product" data-id="${product.id}"></i>
                            <i class="fas fa-trash delete-product" data-id="${product.id}"></i>
                        </div>
                    </div>
                `;
                stockList.appendChild(li);
            });
            
            // Adicionar event listeners para editar e excluir produtos
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const productId = this.getAttribute('data-id');
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const productId = this.getAttribute('data-id');
                    deleteProduct(productId);
                });
            });
        }
        
        // Buscar clientes
        function searchClients() {
            const searchTerm = clientSearchInput.value.toLowerCase();
            
            if (!searchTerm) {
                loadClients();
                return;
            }
            
            const filteredClients = clients.filter(client => 
                client.name.toLowerCase().includes(searchTerm) || 
                client.email.toLowerCase().includes(searchTerm) ||
                client.phone.toLowerCase().includes(searchTerm)
            );
            
            clientList.innerHTML = '';
            
            if (filteredClients.length === 0) {
                clientList.innerHTML = '<div class="empty-cart"><p>Nenhum cliente encontrado</p></div>';
                return;
            }
            
            filteredClients.forEach(client => {
                const li = document.createElement('li');
                li.className = 'client-item';
                li.innerHTML = `
                    <div class="client-info">
                        <strong>${client.name}</strong>
                        <div>${client.email} | ${client.phone}</div>
                        <div>Total em compras: R$ ${client.totalPurchases.toFixed(2)}</div>
                    </div>
                    <div class="client-actions">
                        <i class="fas fa-edit edit-client" data-id="${client.id}"></i>
                        <i class="fas fa-trash delete-client" data-id="${client.id}"></i>
                    </div>
                `;
                clientList.appendChild(li);
            });
            
            // Adicionar event listeners para editar e excluir
            document.querySelectorAll('.edit-client').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const clientId = this.getAttribute('data-id');
                    editClient(clientId);
                });
            });
            
            document.querySelectorAll('.delete-client').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const clientId = this.getAttribute('data-id');
                    deleteClient(clientId);
                });
            });
        }
        
        // Atualizar data e hora
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('pt-BR', options);
            
            // Capitalizar primeira letra
            const formattedDate = dateString.charAt(0).toUpperCase() + dateString.slice(1);
            
            document.querySelector('.date-display').textContent = formattedDate;
        }
    </script>
</body>
</html>

